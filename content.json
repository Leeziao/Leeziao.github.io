{"meta":{"title":"Leeziao的博客","subtitle":"Hello World","description":"华中科技大学人工智能与自动化学院","author":"Leeziao","url":"https://leeziao.github.io","root":"/"},"pages":[],"posts":[{"title":"计网培训-小型局域网","slug":"计网培训-小型局域网","date":"2021-04-08T02:40:27.000Z","updated":"2021-04-10T06:14:07.463Z","comments":true,"path":"2021/04/08/计网培训-小型局域网/","link":"","permalink":"https://leeziao.github.io/2021/04/08/%E8%AE%A1%E7%BD%91%E5%9F%B9%E8%AE%AD-%E5%B0%8F%E5%9E%8B%E5%B1%80%E5%9F%9F%E7%BD%91/","excerpt":"在VMWare上使用三台电脑组成局域网。虚拟机A作为局域网网关，虚拟机BC作为局域网内的一般机器。虚拟机BC之间可以通过虚拟机A作为网关相互通信，虚拟机BC又可以通过虚拟机A访问外网。","text":"在VMWare上使用三台电脑组成局域网。虚拟机A作为局域网网关，虚拟机BC作为局域网内的一般机器。虚拟机BC之间可以通过虚拟机A作为网关相互通信，虚拟机BC又可以通过虚拟机A访问外网。 主机架构 虚拟机A： eth0（仅主机模式）：用于内网通信。在构建的局域网中作为虚拟机B和虚拟机C的网关 eth1（NAT模式）：通过网关可以和主机通信 虚拟机B： eht0（仅主机模式） 虚拟机C： eth0（仅主机模式） 虚拟机设置网卡 虚拟机A网卡设置，修改/etc/network/interfaces，加入下面代码 12345678910auto eth0iface eth0 inet static # 静态IPaddress 10.1.2.254 # 静态IP地址netmask 255.255.255.0 # 子网掩码auto eth1iface eth1 inet static # 静态IPaddress 192.168.237.5 # 静态IP地址gateway 192.168.237.2 # NAT模式和主机通信的网关netmask 255.255.255.255 # 子网掩码 ​ 更改网卡设置后，通过sudo /etc/init.d/networking restart重启网络服务 虚拟机B网卡设置，修改/etc/network/interfaces，加入下面代码 12345auto eth0iface eth0 inet staticaddress 10.1.2.100gateway 10.1.2.254 # 网关地址为虚拟机eth0网卡地址netmask 255.255.255.0 开启ipv4核心转发功能，使虚拟机B可以通过虚拟机Aping到虚拟C：修改etc/sysctl.conf，添加net.ipv4.ip_forward=1，sysctl -p重新加载配置文件 主机网卡设置：在控制面板&gt;网络和Internet&gt;网络连接中配置网卡VMnet8：在Internet协议版本4中设置静态IP，在这次实验中的设置如下： IP地址：192.168.237.1 子网掩码：255.255.255.0 默认网关：192.168.237.1 Iptables 参考资料：iptables详解（1） Why iptables：实现NAT转换，使虚拟机B和虚拟机C可以访问(ping)公网 iptables可以理解成一个客户端代理，客户通过这个代理设定安全框架，这个框架才是防火墙，叫做netfilter iptables+netfilter组成Linux下的包过滤防火墙，它有以下功能： 网络地址转换（NAT） 数据包内容修改 数据包过滤 iptables与NAT 参考资料：iptables详解（13） 当网络内部的主机向网络外部主机发送报文时，报文会经过防火墙或路由器，当报文经过防火墙或路由器时，将报文的源IP修改为防火墙或者路由器的IP地址，当其他网络中的主机收到这些报文时，显示的源IP地址则是路由器或者防火墙的，而不是那10台主机的IP地址，这样，就起到隐藏网络内部主机IP的作用，当网络内部主机的报文经过路由器时，路由器会维护一张NAT表，表中记录了报文来自于哪个内部主机的哪个进程（内部主机IP+端口），当报文经过路由器时，路由器会将报文的内部主机源IP替换为路由器的IP地址，把源端口也映射为某个端口，NAT表会把这种对应关系记录下来。 添加iptables转发规则：iptables -t nat -A POSTROUTING -s 10.1.2.0/24 -j SNAT --to-source 192.168.237.5 -s 10.1.2.0/24：报文来自于10.1.2.0/24网段 -j SNAT：使用SNAT动作，除此之外还有DNAT动作，见iptables详解（13） -A POSTROUTINING：将该规则加入到POSTROUTINING链末尾 --to-source 192.168.237.5：将源IP修改为192.168.237.5，即虚拟机A的网卡地址 TCPdump抓包 当虚拟机B（10.1.2.101）ping虚拟机C（10.1.2.150），在虚拟机A（10.1.2.254）上抓包 123IP 10.1.2.101 &gt; 10.1.2.150: ICMP echo requestIP 10.1.2.150 &gt; 10.1.2.101: ICMP echo reply... 当虚拟机B（10.1.2.101）ping主机（192.168.237.1）时，在虚拟机A（10.1.2.254）上抓包 123IP 10.1.2.101 &gt; 192.168.237.1: ICMP echo requestIP 192.168.237.1 &gt; 10.1.2.101: ICMP echo reply...","categories":[],"tags":[{"name":"Dian","slug":"Dian","permalink":"https://leeziao.github.io/tags/Dian/"},{"name":"计算机网络","slug":"计算机网络","permalink":"https://leeziao.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"安全","slug":"安全","permalink":"https://leeziao.github.io/tags/%E5%AE%89%E5%85%A8/"}]}],"categories":[],"tags":[{"name":"Dian","slug":"Dian","permalink":"https://leeziao.github.io/tags/Dian/"},{"name":"计算机网络","slug":"计算机网络","permalink":"https://leeziao.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"},{"name":"安全","slug":"安全","permalink":"https://leeziao.github.io/tags/%E5%AE%89%E5%85%A8/"}]}